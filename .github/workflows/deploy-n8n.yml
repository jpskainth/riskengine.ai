name: Deploy n8n workflows

on:
  push:
    branches: [ main ]
    paths:
      - "n8n-workflows/workflows/**"

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Install jq
        run: sudo apt-get install -y jq

      - name: Deploy workflows
        env:
          N8N_BASE_URL: ${{ secrets.N8N_HOST }}
          N8N_API_KEY: ${{ secrets.N8N_API_KEY }}
          N8N_PROJECT_ID: ${{ secrets.N8N_PROJECT_ID }}
        run: |
          for wf in workflows/**/*.json; do
            bash scripts/deploy-workflow.sh "$wf"
          done
